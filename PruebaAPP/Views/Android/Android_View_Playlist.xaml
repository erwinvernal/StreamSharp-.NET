<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pl="clr-namespace:PruebaAPP.Objetos.Models"
             xmlns:vm="clr-namespace:PruebaAPP.Views.Android.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="vm:MainViewModel"
             x:Class="PruebaAPP.Views.Android.Android_View_Playlist">

    <Grid RowDefinitions="60,Auto,*" RowSpacing="10">
        
        <!-- Barra Titulo -->
        <Grid Grid.Row="0">

            <!-- Fondo -->
            <Rectangle Grid.ColumnSpan="2" Fill="{StaticResource backg_night_2}" StrokeThickness="0" Opacity="0.7"/>

            <VerticalStackLayout Grid.Column="1" Margin="15,0" VerticalOptions="Center">
                <Label Text="Mis Playlists" FontSize="18" FontAttributes="Bold" TextColor="{StaticResource foreg_night_2}"/>
                <Label>
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding Playlists.Count}" TextColor="{StaticResource foreg_night_1}"/>
                            <Span Text=" Playlist - " TextColor="{StaticResource foreg_night_1}"/>
                            <Span Text="{Binding Playlist_GetTotalSong}" TextColor="{StaticResource foreg_night_1}"/>
                            <Span Text=" Canciones - " TextColor="{StaticResource foreg_night_1}"/>
                            <Span Text="{Binding Playlists_GetTotalDuration, Converter={StaticResource TimeSpanFormat}}" TextColor="{StaticResource foreg_night_1}"/>
                            <Span Text=" DuraciÃ³n" TextColor="{StaticResource foreg_night_1}"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
            </VerticalStackLayout>
        </Grid>

        <!-- Reproducir todo -->
        <HorizontalStackLayout Grid.Row="1" Margin="0,-36,20,0" HorizontalOptions="End" VerticalOptions="Start" Spacing="10">
            <Border WidthRequest="35" HeightRequest="35" StrokeThickness="1" Stroke="{StaticResource backg_night_2}" StrokeShape="Ellipse">
                <Button Text="&#xe872;" FontSize="20" FontFamily="MaterialIconsRegular" Padding="0" TextColor="{StaticResource foreg_night_2}" BackgroundColor="DarkRed" Command="{Binding Playlist_ClearAllCommand}">
                    <Button.Margin>
                        <OnPlatform x:TypeArguments="Thickness">
                            <On Platform="Android" Value="0"/>
                            <On Platform="WinUI" Value="-5"/>
                        </OnPlatform>
                    </Button.Margin>
                </Button>
            </Border>
            <Border WidthRequest="52" HeightRequest="52" StrokeThickness="1" Stroke="{StaticResource backg_night_2}" StrokeShape="Ellipse">
                <Button Text="&#xe145;" FontSize="24" FontFamily="MaterialIconsRegular" Padding="0" TextColor="{StaticResource foreg_night_2}" BackgroundColor="{StaticResource backg_night_4}" Command="{Binding Playlist_CreatedCommand}"/>
            </Border>
        </HorizontalStackLayout>
        
        <!-- Lista de canciones -->
        <CollectionView Grid.Row="2" Margin="0,0,0,0" ItemsSource="{Binding Playlists}" SelectionMode="Single" SelectionChanged="Click_SelectItemsPlay">
            <CollectionView.EmptyView>
                <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                    <Label Grid.Column="0" Text="ðŸš€" Margin="0,0,0,10" FontSize="42" HorizontalTextAlignment="Center" TextColor="{StaticResource foreg_night_1}"/>
                    <Label WidthRequest="300" Text="AÃºn no has creado ninguna playlist. Empieza una nueva para disfrutar tu mÃºsica como quieras." HorizontalTextAlignment="Center" TextColor="{StaticResource foreg_night_2}"/>

                    <!-- Boton de crear -->
                    <Button Text="Crear playlist" Margin="0,40,0,0" TextColor="{StaticResource foreg_night_2}" BackgroundColor="{StaticResource backg_night_4}" Command="{Binding Playlist_CreatedCommand}"/>

                </VerticalStackLayout>
            </CollectionView.EmptyView>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="pl:Playlist">
                    <Grid ColumnDefinitions="Auto,*,Auto" Padding="15,5">

                        <!-- Cover -->
                        <Border WidthRequest="40" HeightRequest="40" StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10"/>
                            </Border.StrokeShape>
                            <Grid x:Name="ContainerCover" RowDefinitions="*,*" ColumnDefinitions="*,*">

                                <!-- Imagen sin no hay nada-->
                                <Rectangle Grid.RowSpan="2" Grid.ColumnSpan="2" StrokeThickness="0" Fill="{StaticResource backg_night_2}" IsVisible="{Binding Items.Count, Converter={StaticResource IntToBool}}"/>

                                <!-- Cuando hay imagen -->
                                <Image Grid.Row="0" Grid.Column="0" Aspect="AspectFill">
                                    <Image.Style>
                                        <Style TargetType="Image">
                                            <Style.Triggers>
                                                <DataTrigger TargetType="Image" Binding="{Binding Items.Count}" Value="1">
                                                    <Setter Property="Source" Value="{Binding Items[0].ThumbnailLowRes}"/>
                                                    <Setter Property="Grid.RowSpan" Value="2"/>
                                                    <Setter Property="Grid.ColumnSpan" Value="2"/>
                                                </DataTrigger>
                                                <DataTrigger TargetType="Image" Binding="{Binding Items.Count}" Value="2">
                                                    <Setter Property="Source" Value="{Binding Items[0].ThumbnailLowRes}"/>
                                                    <Setter Property="Grid.RowSpan" Value="2"/>
                                                </DataTrigger>
                                                <DataTrigger TargetType="Image" Binding="{Binding Items.Count, Converter={StaticResource GreaterThan}, ConverterParameter=3}" Value="True">
                                                    <Setter Property="Source" Value="{Binding Items[0].ThumbnailLowRes}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Image.Style>
                                </Image>
                                <Image Grid.Row="0" Grid.Column="1" Aspect="AspectFill">
                                    <Image.Style>
                                        <Style TargetType="Image">
                                            <Style.Triggers>
                                                <DataTrigger TargetType="Image" Binding="{Binding Items.Count}" Value="2">
                                                    <Setter Property="Source" Value="{Binding Items[1].ThumbnailLowRes}"/>
                                                    <Setter Property="Grid.RowSpan" Value="2"/>
                                                </DataTrigger>
                                                <DataTrigger TargetType="Image" Binding="{Binding Items.Count, Converter={StaticResource GreaterThan}, ConverterParameter=3}" Value="True">
                                                    <Setter Property="Source" Value="{Binding Items[1].ThumbnailLowRes}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Image.Style>
                                </Image>
                                <Image Grid.Row="1" Grid.Column="0" Aspect="AspectFill">
                                    <Image.Style>
                                        <Style TargetType="Image">
                                            <Style.Triggers>
                                                <DataTrigger TargetType="Image" Binding="{Binding Items.Count}" Value="3">
                                                    <Setter Property="Source" Value="{Binding Items[2].ThumbnailLowRes}"/>
                                                    <Setter Property="Grid.ColumnSpan" Value="2"/>
                                                </DataTrigger>
                                                <DataTrigger TargetType="Image" Binding="{Binding Items.Count, Converter={StaticResource GreaterThan}, ConverterParameter=4}" Value="True">
                                                    <Setter Property="Source" Value="{Binding Items[2].ThumbnailLowRes}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Image.Style>
                                </Image>
                                <Image Grid.Row="1" Grid.Column="1" Aspect="AspectFill">
                                    <Image.Style>
                                        <Style TargetType="Image">
                                            <Style.Triggers>
                                                <DataTrigger TargetType="Image" Binding="{Binding Items.Count, Converter={StaticResource GreaterThan}, ConverterParameter=4}" Value="True">
                                                    <Setter Property="Source" Value="{Binding Items[3].ThumbnailLowRes}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Image.Style>
                                </Image>
                                
                            </Grid>
                        </Border>

                        <!-- Informacion -->
                        <VerticalStackLayout Grid.Column="1" Margin="10,0,0,0" VerticalOptions="Center" >
                            <Label Text="{Binding Title}">
                                <Label.Style>
                                    <Style TargetType="Label">
                                        <Style.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsPlaying}" Value="True">
                                                <Setter Property="TextColor" Value="{StaticResource foreg_night_0}"/>
                                            </DataTrigger>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsPlaying}" Value="False">
                                                <Setter Property="TextColor" Value="{StaticResource foreg_night_2}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Label.Style>
                            </Label>
                            <HorizontalStackLayout>
                                <Label Text="{Binding Items.Count}" TextColor="{StaticResource foreg_night_1}"/>
                                <Label Text="Canciones" Margin="5,0,0,0" TextColor="{StaticResource foreg_night_1}"/>
                                <Label Text="-" Margin="5,0,0,0" TextColor="{StaticResource foreg_night_1}"/>
                                <Label Text="{Binding GetTotalDuration, Converter={StaticResource TimeSpanFormat}}" Margin="5,0,0,0"  TextColor="{StaticResource foreg_night_1}"/>
                                <Label Text="DuraciÃ³n" Margin="5,0,0,0" TextColor="{StaticResource foreg_night_1}"/>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                        <!-- ELiminar -->
                        <Button Grid.Column="2"  WidthRequest="40" HeightRequest="40"
                                    Text="&#xe872;" 
                                    FontSize="24" 
                                    Padding="0"
                                    FontFamily="MaterialIconsRegular" 
                                    TextColor="{StaticResource foreg_night_2}" 
                                    BackgroundColor="Transparent"
                                    VerticalOptions="Start"
                                    Clicked="Click_SelectedItemsMenu"/>

                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>
</ContentView>
