<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pl="clr-namespace:PruebaAPP.Objetos.Models"
             xmlns:vm="clr-namespace:PruebaAPP.Views.Android.ViewModels"
             x:DataType="vm:MainViewModel"
             x:Class="PruebaAPP.Views.Android.Android_View_ViewPlaylist">

    <Grid RowDefinitions="60,Auto,*" RowSpacing="10">

        <!-- Barra de titulo -->
        <Grid Grid.Row="0" ColumnDefinitions="40, *">

            <!-- Fondo -->
            <Rectangle Grid.ColumnSpan="2" Fill="{StaticResource backg_night_2}" StrokeThickness="0" Opacity="0.7"/>

            <!-- Back -->
            <Border WidthRequest="40" HeightRequest="40" Margin="10,0,0,0" StrokeThickness="0" StrokeShape="Ellipse" VerticalOptions="Center">
                <Button Text="&#xe5e0;" FontSize="20" FontFamily="MaterialIconsRegular" Padding="6,0,0,0" TextColor="{StaticResource foreg_night_2}" Background="Transparent" Clicked="Click_BackPage"/>
            </Border>

            <!-- Informacion -->
            <VerticalStackLayout Grid.Column="1" Margin="15,0" VerticalOptions="Center">
                <Label Text="{Binding Player.ViewPlaylist.Title}" FontSize="18" FontAttributes="Bold" TextColor="{StaticResource foreg_night_2}"/>
                <Label>
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding Player.ViewPlaylist.Items.Count}" TextColor="{StaticResource foreg_night_1}"/>
                            <Span Text=" Canciones - " TextColor="{StaticResource foreg_night_1}"/>
                            <Span Text="{Binding Player.ViewPlaylist.GetTotalDuration, Converter={StaticResource TimeSpanFormat}}" TextColor="{StaticResource foreg_night_1}"/>
                            <Span Text=" DuraciÃ³n" TextColor="{StaticResource foreg_night_1}"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
            </VerticalStackLayout>
        </Grid>

        <!-- Reproducir todo -->
        <HorizontalStackLayout Grid.Row="1" Margin="20,-36,30,0" HorizontalOptions="End" Spacing="5">
            <Border WidthRequest="40" HeightRequest="40" StrokeThickness="1" Stroke="{StaticResource backg_night_2}" StrokeShape="Ellipse" IsVisible="False">
                <Button Text="&#xe5d3;" FontSize="20" FontFamily="MaterialIconsRegular" Padding="0" TextColor="{StaticResource foreg_night_2}" BackgroundColor="{StaticResource backg_night_0}"/>
            </Border>
            <Border WidthRequest="52" HeightRequest="52" StrokeThickness="1" Stroke="{StaticResource backg_night_2}" StrokeShape="Ellipse">
                <Button Text="&#xe037;" FontSize="24" FontFamily="MaterialIconsRegular" Padding="0" TextColor="{StaticResource foreg_night_2}" BackgroundColor="{StaticResource backg_night_4}" Clicked="Click_PlayAll"/>
            </Border>
        </HorizontalStackLayout>

        <!-- Contenido -->
        <CollectionView Grid.Row="2" Margin="0,0,0,0" ItemsSource="{Binding Player.ViewPlaylist.Items}" SelectionMode="Single" ItemsUpdatingScrollMode="KeepScrollOffset" ItemSizingStrategy="MeasureFirstItem" SelectionChanged="Click_SelectView">
            <CollectionView.EmptyView>
                <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                    <Label Grid.Column="0" Text="ðŸŽµ" Margin="0,0,0,10" FontSize="42" HorizontalTextAlignment="Center" TextColor="{StaticResource foreg_night_1}"/>
                    <Label WidthRequest="300" Text="Tu playlist aÃºn no tiene canciones. Explora, encuentra tu mÃºsica favorita y agrÃ©gala para empezar a disfrutarla." HorizontalTextAlignment="Center" TextColor="{StaticResource foreg_night_2}"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="pl:Song">
                    <Grid ColumnDefinitions="Auto,*,Auto" Padding="15,5">

                        <!-- Cover -->
                        <Border Grid.Column="0" Margin="0,0,10,0" StrokeThickness="0" WidthRequest="50" HeightRequest="50" VerticalOptions="Start">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10"/>
                            </Border.StrokeShape>
                            <Grid>

                                <!-- Imagen -->
                                <Image x:Name="MainImage" Aspect="AspectFill">
                                    <Image.Source>
                                        <UriImageSource Uri="{Binding ThumbnailLowRes}" CacheValidity="7.00:00:00" CachingEnabled="True" />
                                    </Image.Source>
                                </Image>

                                <!-- Loader mientras carga -->
                                <ActivityIndicator x:DataType="Image" WidthRequest="40" HeightRequest="40" 
                                               IsRunning="{Binding Source={x:Reference MainImage}, Path=IsLoading}" 
                                               Color="{StaticResource foreg_night_2}" 
                                               IsVisible="{Binding Source={x:Reference MainImage}, Path=IsLoading}" />

                            </Grid>
                        </Border>

                        <!-- Informacion -->
                        <VerticalStackLayout Grid.Column="1" Margin="0,0,10,0" VerticalOptions="Center">

                            <!-- Titulo de la cancion -->
                            <Label Text="{Binding Title}" MaxLines="1" LineBreakMode="TailTruncation" HorizontalTextAlignment="Start" TextColor="{StaticResource foreg_night_2}"/>

                            <!-- Otros datos -->
                            <Grid ColumnDefinitions="*,Auto">

                                <!-- Author -->
                                <Label Grid.Column="0" Text="{Binding Author.ChannelTitle}"   TextColor="{StaticResource foreg_night_1}"/>

                                <!-- Duracion -->
                                <Label Grid.Column="1" Text="{Binding Duration, Converter={StaticResource TimeSpanFormat}}" TextColor="{StaticResource foreg_night_1}"/>

                            </Grid>

                        </VerticalStackLayout>

                        <!-- Icono de eliminar -->
                        <Button Grid.Column="2" WidthRequest="40" HeightRequest="40" Padding="0" Text="&#xe5d4;" FontSize="20"  FontFamily="MaterialIconsRegular"  TextColor="{StaticResource foreg_night_2}"  BackgroundColor="Transparent" VerticalOptions="Start" Clicked="Click_DeleteItems"/>

                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>
</ContentView>
